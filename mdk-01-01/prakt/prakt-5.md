**Техническое задание: Информационная система управления складом**

---

### Описание проекта

Разработать информационную систему управления складом на Python с использованием PostgreSQL. Система должна управлять складскими запасами, поставщиками, заказами и логистикой, выполнять операции CRUD (Create, Read, Update, Delete), поддерживать расширенный поиск, аналитику и управление транзакциями. Проект должен быть реализован в среде Replit или CodeSandBox с использованием современного синтаксиса Python, асинхронного программирования (asyncio) и соблюдением стандартов оформления кода (PEP 8). Система должна поддерживать многопользовательский доступ с ролями (администратор, менеджер, кладовщик).

---

### Цели проекта

1. Ознакомить студентов с работой с PostgreSQL и асинхронным программированием в Python.
2. Научить реализовывать сложные CRUD-операции, аналитику, управление транзакциями и ролевую модель.
3. Развить навыки проектирования масштабируемой архитектуры приложения.
4. Закрепить стандарты написания чистого кода и работы с асинхронными библиотеками.

---

### Функциональные требования

#### 1. Основные функции системы

**Управление товарами:**

- **Создание**: Добавление нового товара (название, категория, артикул, цена, количество на складе, минимальный запас).
- **Чтение**: Просмотр списка всех товаров, конкретного товара по ID или артикулу.
- **Обновление**: Изменение информации о товаре (название, категория, цена, количество, минимальный запас).
- **Удаление**: Удаление товара (только если он не участвует в активных заказах).

**Управление поставщиками:**

- **Создание**: Добавление нового поставщика (название, контактное лицо, email, телефон).
- **Чтение**: Просмотр списка всех поставщиков или конкретного поставщика по ID или email.
- **Обновление**: Изменение информации о поставщике (название, контакты).
- **Удаление**: Удаление поставщика (только если нет связанных заказов).

**Управление заказами:**

- **Создание заказа**: Формирование заказа на поставку (поставщик, список товаров, количество, дата заказа, статус: "в обработке", "выполнен", "отменен").
  - Проверка наличия поставщика и товаров.
  - Автоматическое обновление количества товаров на складе при выполнении заказа.
- **Отмена заказа**: Изменение статуса на "отменен" с проверкой, что заказ не выполнен.
- **Подтверждение заказа**: Изменение статуса на "выполнен", обновление складских запасов.
- **Просмотр заказов**: По статусу, поставщику или дате.

**Управление пользователями и ролями:**

- Роли: администратор (полный доступ), менеджер (управление заказами и поставщиками), кладовщик (управление товарами и заказами).
- **Создание пользователя**: Регистрация (логин, пароль, роль, email).
- **Аутентификация**: Вход в систему по логину и паролю.
- **Ограничение доступа**: Проверка роли перед выполнением операций (например, только администратор может удалять пользователей).

**Поиск и аналитика:**

- **Поиск товаров**:
  - По названию или категории (частичное совпадение, без учета регистра).
  - По артикулу (точное совпадение).
- **Фильтрация товаров**:
  - По количеству (например, товары с запасом ниже минимального).
  - По категории.
  - По цене (диапазон).
- **Поиск поставщиков**:
  - По названию или email (частичное совпадение).
- **Аналитика**:
  - Отчет о товарах с низким запасом (меньше минимального).
  - Суммарная стоимость товаров на складе.
  - Статистика заказов за период (по количеству, стоимости, поставщикам).
- Результаты поиска и аналитики отображаются в консоли с форматированным выводом.

#### 2. База данных

- Использовать **PostgreSQL** для хранения данных.
- Создать таблицы:

  **Таблица products**:
  - `id`: Уникальный идентификатор (SERIAL, PRIMARY KEY).
  - `name`: Название товара (VARCHAR(255), NOT NULL).
  - `category`: Категория (VARCHAR(100), NOT NULL).
  - `sku`: Артикул (VARCHAR(50), UNIQUE, NOT NULL).
  - `price`: Цена (DECIMAL(10,2), NOT NULL).
  - `quantity`: Количество на складе (INTEGER, NOT NULL, DEFAULT 0).
  - `min_stock`: Минимальный запас (INTEGER, NOT NULL, DEFAULT 0).

  **Таблица suppliers**:
  - `id`: Уникальный идентификатор (SERIAL, PRIMARY KEY).
  - `name`: Название компании (VARCHAR(255), NOT NULL).
  - `contact_name`: Контактное лицо (VARCHAR(100), NOT NULL).
  - `email`: Email (VARCHAR(255), UNIQUE, NOT NULL).
  - `phone`: Телефон (VARCHAR(20), NOT NULL).

  **Таблица orders**:
  - `id`: Уникальный идентификатор (SERIAL, PRIMARY KEY).
  - `supplier_id`: ID поставщика (INTEGER, FOREIGN KEY references suppliers(id)).
  - `order_date`: Дата заказа (DATE, NOT NULL).
  - `status`: Статус заказа (VARCHAR(20), NOT NULL, DEFAULT 'в обработке').

  **Таблица order_items**:
  - `id`: Уникальный идентификатор (SERIAL, PRIMARY KEY).
  - `order_id`: ID заказа (INTEGER, FOREIGN KEY references orders(id)).
  - `product_id`: ID товара (INTEGER, FOREIGN KEY references products(id)).
  - `quantity`: Количество (INTEGER, NOT NULL).
  - `unit_price`: Цена за единицу на момент заказа (DECIMAL(10,2), NOT NULL).

  **Таблица users**:
  - `id`: Уникальный идентификатор (SERIAL, PRIMARY KEY).
  - `login`: Логин (VARCHAR(50), UNIQUE, NOT NULL).
  - `password`: Хешированный пароль (VARCHAR(255), NOT NULL).
  - `role`: Роль (VARCHAR(20), NOT NULL, ENUM: 'admin', 'manager', 'worker').
  - `email`: Email (VARCHAR(255), UNIQUE, NOT NULL).

#### 3. Интерфейс

- Реализовать консольный интерфейс с асинхронной обработкой команд.
- Меню с командами (зависит от роли пользователя):
  - **Общие**:
    - Вход/выход из системы.
    - Просмотр товаров, поставщиков, заказов.
    - Поиск товаров/поставщиков.
    - Получение аналитических отчетов.
  - **Для кладовщика**:
    - Добавить/обновить/удалить товар.
    - Подтвердить/отменить заказ.
  - **Для менеджера**:
    - Добавить/обновить/удалить поставщика.
    - Создать/обновить заказ.
  - **Для администратора**:
    - Добавить/удалить пользователя.
    - Все функции менеджера и кладовщика.
  - Выход из программы.

---

### Нефункциональные требования

#### Код:
- Соблюдать стандарт **PEP 8** для именования, оформления и структуры.
- Использовать **асинхронное программирование** с библиотекой `asyncpg` для работы с PostgreSQL.
- Структурировать код по модулям: `database.py`, `crud.py`, `analytics.py`, `orders.py`, `auth.py`, `main.py`.

#### Обработка ошибок:
- Обрабатывать исключения при работе с базой данных (дублирование SKU, email, login).
- Валидировать пользовательский ввод (формат email, положительные числа для цен/количества, корректные даты).
- Проверять наличие связанных заказов перед удалением товаров/поставщиков.
- Обрабатывать ошибки аутентификации (неверный логин/пароль).

#### Документация:
- Добавить **docstrings** для всех функций, классов и модулей.
- Включить комментарии для сложных участков кода (например, асинхронные транзакции).
- Создать **README.md** с описанием проекта, инструкцией по запуску и структурой.

#### Архитектура:
- Разделить логику на слои: доступ к данным (`database`), бизнес-логика (`crud`, `analytics`, `orders`, `auth`), интерфейс (`main`).
- Использовать классы для инкапсуляции логики (например, классы `ProductManager`, `OrderManager`).
- Реализовать транзакции для операций с заказами (атомарное обновление запасов и создание заказа).

---

### Технические требования

- **Язык**: Python 3.10+.
- **Библиотеки**:
  - `asyncpg` для асинхронной работы с PostgreSQL.
  - `passlib` для хеширования паролей.
  - `python-dotenv` для управления конфигурацией (например, подключение к базе данных).
- **Среда**: Replit (Python-окружение с поддержкой PostgreSQL).
- **Структура проекта**:

```
warehouse_system/
├── database.py     # Асинхронная работа с PostgreSQL
├── crud.py         # CRUD-операции для товаров, поставщиков, пользователей
├── analytics.py    # Поиск, фильтрация, аналитические отчеты
├── orders.py       # Логика заказов и транзакций
├── auth.py         # Аутентификация и управление ролями
├── main.py         # Консольный интерфейс
├── .env            # Конфигурация (данные для подключения к PostgreSQL)
└── README.md       # Документация проекта
```

---

### Примерный план реализации

1. **database.py**:
   - Асинхронная функция `init_database()`: создание таблиц.
   - Функции для подключения/закрытия пула соединений с PostgreSQL.
   - Транзакции для атомарных операций.

2. **crud.py**:
   - Асинхронные функции для товаров: `create_product()`, `read_products()`, `update_product()`, `delete_product()`.
   - Аналогичные функции для поставщиков и пользователей.
   - Проверка уникальности и валидации.

3. **analytics.py**:
   - Асинхронные функции для поиска: `search_products_by_name()`, `search_suppliers_by_email()`.
   - Фильтрация: `filter_products_by_stock()`, `filter_by_category()`.
   - Аналитика: `low_stock_report()`, `total_inventory_value()`, `orders_by_period()`.

4. **orders.py**:
   - Асинхронные функции: `create_order()`, `confirm_order()`, `cancel_order()`.
   - Транзакции для обновления запасов и создания записей в `order_items`.

5. **auth.py**:
   - Асинхронные функции: `register_user()`, `login_user()`, `check_role()`.
   - Хеширование паролей с `passlib`.
   - Проверка прав доступа.

6. **main.py**:
   - Асинхронный консольный интерфейс с меню.
   - Цикл обработки команд с использованием `asyncio`.
   - Валидация ввода и ролевой доступ.

---

### Критерии оценки

Оценка **2 (неудовлетворительно)**:
- Реализована только часть CRUD-операций.
- Отсутствует функционал заказов, аналитики, ролевой модели.
- Код не структурирован, нет асинхронности.
- Много ошибок в синтаксисе/логике.
- Игнорируются PEP 8, нет аннотаций типов.
- Нет обработки ошибок и документации.

Оценка **3 (удовлетворительно)**:
- Реализованы CRUD-операции с незначительными ошибками.
- Базовый функционал заказов и поиска (например, только по названию).
- Частичная асинхронность, но без транзакций.
- Код структурирован, но модули не оптимальны.
- Основные правила PEP 8 соблюдены, аннотации типов частично.
- Минимальная обработка ошибок.
- Базовые docstrings.

Оценка **4 (хорошо)**:
- Все CRUD-операции, заказы, базовая аналитика работают корректно.
- Реализованы поиск, фильтрация, ролевая модель.
- Код структурирован, используются асинхронные функции.
- Соблюдаются PEP 8, аннотации типов для большинства функций.
- Хорошая обработка ошибок (ввод, база данных, роли).
- Полные docstrings, комментарии для сложных участков.
- Удобный интерфейс.

Оценка **5 (отлично)**:
- Все функции (CRUD, заказы, аналитика, роли) работают безупречно.
- Дополнительные улучшения (например, сложные запросы, форматированный вывод, валидация формата SKU).
- Код идеально структурирован, полная асинхронность с транзакциями.
- Полное соблюдение PEP 8, аннотации типов везде.
- Комплексная обработка ошибок и валидация.
- Подробная документация (docstrings, комментарии, README).
- Интуитивный интерфейс с форматированным выводом.

---

### Рекомендации

- Изучите документацию по `asyncpg` и асинхронному программированию в Python.
- Используйте линтер (например, `flake8`) в Replit для проверки PEP 8.
- Тестируйте асинхронные функции отдельно перед интеграцией.
- Реализуйте транзакции для операций с заказами.
- Настройте `.env` для безопасного хранения данных PostgreSQL.
- Регулярно сохраняйте проект в Replit и делайте резервные копии.

---

### Ожидаемый результат

Работающая консольная программа для управления складом, использующая PostgreSQL, с асинхронной обработкой, ролевой моделью, аналитикой, надежной обработкой ошибок и интуитивным интерфейсом.
